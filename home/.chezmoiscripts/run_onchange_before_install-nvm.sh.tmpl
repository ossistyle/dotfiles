{{ if and (eq .osid "linux-pop" "linux-ubuntu") (not .ephemeral) -}}

#!/bin/sh

echo "Setup Node Version Manager (nvm) ..."

# https://github.com/nvm-sh/nvm?tab=readme-ov-file#installing-and-updating

{{ if stat (joinPath .chezmoi.homeDir ".nvm") }}

echo "Updating Node Version Manager (nvm) ..."

(
  cd "$NVM_DIR"
  git fetch --tags origin
  git checkout `git describe --abbrev=0 --tags --match "v[0-9]*" $(git rev-list --tags --max-count=1)`
) && \. "$NVM_DIR/nvm.sh"

{{ else -}}

export NVM_DIR="$HOME/.nvm" && (
  git clone https://github.com/nvm-sh/nvm.git "$NVM_DIR"
  cd "$NVM_DIR"
  git checkout `git describe --abbrev=0 --tags --match "v[0-9]*" $(git rev-list --tags --max-count=1)`
) && \. "$NVM_DIR/nvm.sh"

{{ end -}}

nvm install node

{{ end -}}